import{d as M,r as i,j as S,o as D,s as O,c as l,a as s,b as v,x as y,u as p,I as f,t as m,y as R,g as b,z as g,A as w,n as h,B as q,v as F,l as G,h as n,_ as T}from"./index-C5EFz0i3.js";import{u as L}from"./useUsers-91VFVrqH.js";const P={class:"w-full"},H={class:"mb-6"},J={class:"mb-3"},K={class:"flex items-start justify-between"},Q={class:"flex items-center"},W=["disabled"],X={key:0,class:"flex items-center"},Y={key:1,class:"flex items-center"},Z={class:"w-full"},$={key:0,class:"flex items-center justify-center py-12"},ee={key:1,class:"bg-red-50 border border-red-200 rounded-md p-4 mb-6"},se={class:"flex"},ae={class:"ml-3"},oe={class:"mt-2 text-sm text-red-700"},te={key:2,class:"bg-white py-8 px-6 shadow sm:rounded-lg"},re={class:"mt-1"},le={key:0,class:"mt-2 text-sm text-red-600"},ne={class:"mt-1"},de={key:0,class:"mt-2 text-sm text-red-600"},ie={class:"mt-1"},ue={key:0,class:"mt-2 text-sm text-red-600"},me={class:"mt-1"},ce={key:0,class:"bg-red-50 border border-red-200 rounded-md p-4"},ve={class:"flex"},pe={class:"ml-3"},fe={class:"mt-2 text-sm text-red-700"},be=M({__name:"editAdmin",props:{id:{}},setup(C){const V=C,_=F(),U=O(),{getUser:z,updateUser:j}=L(),a=i({name:"",email:"",password:void 0,role:"admin"}),u=i(!1),x=i(!1),r=i(""),o=i({}),c=i(null),A=S(()=>{const t=!!a.value.name&&a.value.name.trim().length>=2,e=(a.value.email||"").toString().trim(),d=e.length>0&&/.+@.+\..+/.test(e),I=!a.value.password||a.value.password.length>=6;return t&&d&&I&&!u.value});D(async()=>{await N()});async function N(){const t=V.id||U.params.id;if(!t){r.value="ID de usuario no válido";return}x.value=!0,r.value="";try{c.value=Number(t);const e=await z(c.value);a.value={name:e.name||"",email:e.email||"",role:e.role||"client"}}catch(e){console.error("Error al cargar usuario:",e),e?.response?.status===404?r.value="Usuario no encontrado":r.value=e?.response?.data?.message||"Error al cargar usuario"}finally{x.value=!1}}function B(){return o.value={},a.value.name.trim()?a.value.name.trim().length<2&&(o.value.name="El nombre debe tener al menos 2 caracteres"):o.value.name="El nombre es obligatorio",a.value.email.trim()?/.+@.+\..+/.test(a.value.email.trim())||(o.value.email="Formato de email inválido"):o.value.email="El email es obligatorio",a.value.password&&a.value.password.length<6&&(o.value.password="La contraseña debe tener al menos 6 caracteres"),Object.keys(o.value).length===0}async function k(){if(B()&&c.value){u.value=!0,r.value="";try{const t={name:a.value.name.trim(),email:a.value.email.trim(),role:a.value.role};a.value.password&&(t.password=a.value.password);const e=await j(c.value,t);_.push({path:"/adminproductos/usuarios",query:{success:"updated",name:e.name}})}catch(t){console.error("Error al actualizar usuario:",t);const e=t?.response?.data?.message||t?.response?.data?.error;t?.response?.status===404?r.value="Usuario no encontrado":r.value=e||"Error al actualizar usuario",G.error("Error al actualizar usuario",{autoClose:2e3})}finally{u.value=!1}}}function E(){_.push("/adminproductos/usuarios")}return(t,e)=>(n(),l("div",P,[s("div",H,[s("div",J,[s("button",{onClick:E,type:"button",class:"inline-flex items-center text-sm text-indigo-600 hover:text-indigo-800"},[v(p(f),{icon:"mdi:arrow-left",class:"w-5 h-5 mr-2"}),e[4]||(e[4]=y(" Volver ",-1))])]),s("div",K,[e[7]||(e[7]=s("div",{class:"text-left"},[s("h2",{class:"text-3xl font-extrabold text-gray-900"},"Editar Administrador"),s("p",{class:"mt-1 text-sm text-gray-600"},"Actualiza los datos del administrador")],-1)),s("div",Q,[s("button",{onClick:k,type:"button",disabled:u.value||!A.value,class:"ml-4 inline-flex items-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},[u.value?(n(),l("div",X,[...e[5]||(e[5]=[s("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},null,-1),y(" Guardando... ",-1)])])):(n(),l("span",Y,[v(p(f),{icon:"mdi:content-save",class:"w-4 h-4 mr-2"}),e[6]||(e[6]=y(" Guardar ",-1))]))],8,W)])])]),s("div",Z,[x.value?(n(),l("div",$,[...e[8]||(e[8]=[s("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"},null,-1),s("span",{class:"ml-2 text-slate-600"},"Cargando usuario...",-1)])])):r.value&&!a.value.name?(n(),l("div",ee,[s("div",se,[v(p(f),{icon:"mdi:alert-circle",class:"h-5 w-5 text-red-400"}),s("div",ae,[e[9]||(e[9]=s("h3",{class:"text-sm font-medium text-red-800"},"Error al cargar usuario",-1)),s("div",oe,m(r.value),1),s("button",{onClick:E,class:"mt-3 text-red-800 underline hover:no-underline"},"Volver a la lista")])])])):(n(),l("div",te,[s("form",{onSubmit:R(k,["prevent"]),class:"space-y-6 w-full"},[s("div",null,[e[10]||(e[10]=s("label",{for:"name",class:"block text-sm font-medium text-gray-700"},"Nombre *",-1)),s("div",re,[g(s("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=d=>a.value.name=d),type:"text",required:"",maxlength:"100",class:h(["appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",{"border-red-300 focus:border-red-500 focus:ring-red-500":o.value.name}]),placeholder:"Ej: María Pérez"},null,2),[[w,a.value.name]]),o.value.name?(n(),l("p",le,m(o.value.name),1)):b("",!0)])]),s("div",null,[e[11]||(e[11]=s("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"Email *",-1)),s("div",ne,[g(s("input",{id:"email","onUpdate:modelValue":e[1]||(e[1]=d=>a.value.email=d),type:"email",required:"",maxlength:"254",class:h(["appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",{"border-red-300 focus:border-red-500 focus:ring-red-500":o.value.email}]),placeholder:"ejemplo@dominio.com"},null,2),[[w,a.value.email]]),o.value.email?(n(),l("p",de,m(o.value.email),1)):b("",!0)])]),s("div",null,[e[12]||(e[12]=s("label",{for:"password",class:"block text-sm font-medium text-gray-700"},"Contraseña (dejar vacío para no cambiar)",-1)),s("div",ie,[g(s("input",{id:"password","onUpdate:modelValue":e[2]||(e[2]=d=>a.value.password=d),type:"password",minlength:"6",class:h(["appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",{"border-red-300 focus:border-red-500 focus:ring-red-500":o.value.password}]),placeholder:"Al menos 6 caracteres"},null,2),[[w,a.value.password]]),o.value.password?(n(),l("p",ue,m(o.value.password),1)):b("",!0)])]),s("div",null,[e[14]||(e[14]=s("label",{for:"role",class:"block text-sm font-medium text-gray-700"},"Rol",-1)),s("div",me,[g(s("select",{id:"role","onUpdate:modelValue":e[3]||(e[3]=d=>a.value.role=d),class:"block w-full rounded-md border-gray-300 shadow-sm sm:text-sm py-2 px-3"},[...e[13]||(e[13]=[s("option",{value:"admin"},"Administrador",-1),s("option",{value:"client"},"Cliente",-1)])],512),[[q,a.value.role]])])]),r.value?(n(),l("div",ce,[s("div",ve,[v(p(f),{icon:"mdi:alert-circle",class:"h-5 w-5 text-red-400"}),s("div",pe,[e[15]||(e[15]=s("h3",{class:"text-sm font-medium text-red-800"},"Error al actualizar usuario",-1)),s("div",fe,m(r.value),1)])])])):b("",!0)],32)]))])]))}}),ye=T(be,[["__scopeId","data-v-b8e4aa6c"]]);export{ye as default};
