import{d as A,r as d,j as B,o as M,c as l,a as t,b as y,x as k,u as h,I as _,t as n,y as j,g as m,z as p,A as b,n as x,B as q,F as G,e as O,f as T,v as z,h as i,_ as K}from"./index-C5EFz0i3.js";import{u as L}from"./useProducts-LmEOPVqc.js";import{u as R}from"./useCategories-C0eZ0PpZ.js";const W={class:"w-full"},H={class:"mb-6"},J={class:"mb-3"},Q={class:"flex items-start justify-between"},X={class:"flex items-center"},Y=["disabled"],Z={key:0,class:"flex items-center"},$={key:1,class:"flex items-center"},ee={class:"w-full"},te={class:"bg-white py-8 px-6 shadow sm:rounded-lg"},oe={class:"mt-1"},se={key:0,class:"mt-2 text-sm text-red-600"},re={class:"mt-1"},ae={key:0,class:"mt-2 text-sm text-red-600"},le={class:"mt-2 text-sm text-gray-500"},ie={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ne={class:"mt-1"},de={key:0,class:"mt-2 text-sm text-red-600"},ue={class:"mt-1"},ce={key:0,class:"mt-2 text-sm text-red-600"},me={class:"mt-1"},pe=["value"],ve={class:"mt-1 flex items-center"},fe={key:0,class:"mt-1 text-sm text-green-600"},ge={key:1,class:"mt-1 text-xs text-gray-500"},be={key:0,class:"bg-red-50 border border-red-200 rounded-md p-4"},xe={class:"flex"},ye={class:"ml-3"},ke={class:"mt-2 text-sm text-red-700"},he=A({__name:"createProduct",setup(_e){const w=z(),{createProduct:V}=L(),{fetchCategories:E,filteredCategories:N}=R(),o=d({name:"",description:"",price:0,imageUrl:"",stock:0,categoryId:null}),v=d(null),f=d(""),u=d(!1),c=d("Guardando..."),g=d(""),s=d({}),C=d([]),U=B(()=>{const a=!!o.value.name&&o.value.name.trim().length>=2,e=o.value.price!=null&&!isNaN(Number(o.value.price))&&Number(o.value.price)>=0;return a&&e&&!u.value});function D(a){const e=a.target;e.files&&e.files[0]?(v.value=e.files[0],f.value=e.files[0].name):(v.value=null,f.value="")}function F(){return s.value={},!o.value.name||!o.value.name.trim()?s.value.name="El nombre es obligatorio":o.value.name.trim().length<2&&(s.value.name="El nombre debe tener al menos 2 caracteres"),o.value.price==null||isNaN(Number(o.value.price))?s.value.price="El precio es obligatorio":Number(o.value.price)<0&&(s.value.price="El precio no puede ser negativo"),Object.keys(s.value).length===0}async function I(){if(F()){u.value=!0,g.value="",c.value="Procesando...";try{let a=null;if(v.value){c.value="Subiendo imagen...";const S=new FormData;S.append("imagen",v.value),a=(await T.post("/products/upload-image",S,{headers:{"Content-Type":"multipart/form-data"}})).data.imageKey}c.value="Creando producto...";const e={name:o.value.name.trim(),description:o.value.description?.trim()||void 0,price:Number(o.value.price),imageUrl:a||void 0,stock:o.value.stock!=null?Number(o.value.stock):0,categoryId:o.value.categoryId??void 0},r=await V(e);w.push({path:"/adminproductos",query:{success:"created",name:r.name}})}catch(a){console.error("Error al crear producto:",a);const e=a?.response?.data?.message||a?.response?.data?.error||"Error inesperado al crear el producto";g.value=e}finally{u.value=!1,c.value="Guardar"}}}function P(){w.push("/adminproductos")}return M(async()=>{try{await E(),C.value=Array.isArray(N.value)?N.value:[]}catch{}}),(a,e)=>(i(),l("div",W,[t("div",H,[t("div",J,[t("button",{onClick:P,type:"button",class:"inline-flex items-center text-sm text-indigo-600 hover:text-indigo-800"},[y(h(_),{icon:"mdi:arrow-left",class:"w-5 h-5 mr-2"}),e[5]||(e[5]=k(" Volver ",-1))])]),t("div",Q,[e[8]||(e[8]=t("div",{class:"text-left"},[t("h2",{class:"text-3xl font-extrabold text-gray-900"},"Crear Nuevo Producto"),t("p",{class:"mt-1 text-sm text-gray-600"},"Agrega un producto al catálogo (Imágenes vía AWS S3)")],-1)),t("div",X,[t("button",{onClick:I,type:"button",disabled:u.value||!U.value,class:"ml-4 inline-flex items-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},[u.value?(i(),l("div",Z,[e[6]||(e[6]=t("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},null,-1)),k(" "+n(c.value),1)])):(i(),l("span",$,[y(h(_),{icon:"mdi:content-save",class:"w-4 h-4 mr-2"}),e[7]||(e[7]=k(" Guardar ",-1))]))],8,Y)])])]),t("div",ee,[t("div",te,[t("form",{onSubmit:j(I,["prevent"]),class:"space-y-6 w-full"},[t("div",null,[e[9]||(e[9]=t("label",{for:"name",class:"block text-sm font-medium text-gray-700"},"Nombre *",-1)),t("div",oe,[p(t("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=r=>o.value.name=r),type:"text",required:"",maxlength:"200",class:x(["appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",{"border-red-300 focus:border-red-500 focus:ring-red-500":s.value.name}]),placeholder:"Ej: Auriculares Inalámbricos"},null,2),[[b,o.value.name]]),s.value.name?(i(),l("p",se,n(s.value.name),1)):m("",!0)])]),t("div",null,[e[10]||(e[10]=t("label",{for:"description",class:"block text-sm font-medium text-gray-700"},"Descripción (opcional)",-1)),t("div",re,[p(t("textarea",{id:"description","onUpdate:modelValue":e[1]||(e[1]=r=>o.value.description=r),rows:"3",maxlength:"1000",class:x(["appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",{"border-red-300 focus:border-red-500 focus:ring-red-500":s.value.description}]),placeholder:"Describe brevemente el producto..."},null,2),[[b,o.value.description]]),s.value.description?(i(),l("p",ae,n(s.value.description),1)):m("",!0),t("p",le,n(o.value.description?.length||0)+"/1000 caracteres",1)])]),t("div",ie,[t("div",null,[e[11]||(e[11]=t("label",{for:"price",class:"block text-sm font-medium text-gray-700"},"Precio (USD) *",-1)),t("div",ne,[p(t("input",{id:"price","onUpdate:modelValue":e[2]||(e[2]=r=>o.value.price=r),type:"number",step:"0.01",min:"0",required:"",class:x(["appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",{"border-red-300 focus:border-red-500 focus:ring-red-500":s.value.price}]),placeholder:"0.00"},null,2),[[b,o.value.price,void 0,{number:!0}]]),s.value.price?(i(),l("p",de,n(s.value.price),1)):m("",!0)])]),t("div",null,[e[12]||(e[12]=t("label",{for:"stock",class:"block text-sm font-medium text-gray-700"},"Stock",-1)),t("div",ue,[p(t("input",{id:"stock","onUpdate:modelValue":e[3]||(e[3]=r=>o.value.stock=r),type:"number",step:"1",min:"0",class:x(["appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",{"border-red-300 focus:border-red-500 focus:ring-red-500":s.value.stock}]),placeholder:"0"},null,2),[[b,o.value.stock,void 0,{number:!0}]]),s.value.stock?(i(),l("p",ce,n(s.value.stock),1)):m("",!0)])]),t("div",null,[e[14]||(e[14]=t("label",{for:"category",class:"block text-sm font-medium text-gray-700"},"Categoría",-1)),t("div",me,[p(t("select",{id:"category","onUpdate:modelValue":e[4]||(e[4]=r=>o.value.categoryId=r),class:"block w-full rounded-md border-gray-300 shadow-sm sm:text-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 border"},[e[13]||(e[13]=t("option",{value:null},"Sin categoría",-1)),(i(!0),l(G,null,O(C.value,r=>(i(),l("option",{key:r.id,value:r.id},n(r.name),9,pe))),128))],512),[[q,o.value.categoryId]])])])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700"},"Imagen del Producto",-1)),t("div",ve,[t("input",{type:"file",onChange:D,accept:"image/*",class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"},null,32)]),f.value?(i(),l("p",fe," Archivo seleccionado: "+n(f.value),1)):(i(),l("p",ge," Si no seleccionas imagen, se guardará sin foto. "))]),g.value?(i(),l("div",be,[t("div",xe,[y(h(_),{icon:"mdi:alert-circle",class:"h-5 w-5 text-red-400"}),t("div",ye,[e[16]||(e[16]=t("h3",{class:"text-sm font-medium text-red-800"},"Error al crear producto",-1)),t("div",ke,n(g.value),1)])])])):m("",!0)],32)])])]))}}),Se=K(he,[["__scopeId","data-v-e584465d"]]);export{Se as default};
