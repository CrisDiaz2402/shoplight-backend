import{d as M,r as i,j as R,o as S,s as T,c as n,a as e,b as u,x,u as m,I as p,t as c,y as q,g as b,z as w,A as k,n as C,v as F,l as G,h as l,_ as U}from"./index-C5EFz0i3.js";import{u as A}from"./useCategories-C0eZ0PpZ.js";const H={class:"w-full"},L={class:"mb-6"},O={class:"mb-3"},Y={class:"flex items-start justify-between"},$={class:"flex items-center"},J=["disabled"],K={key:0,class:"flex items-center"},P={key:1,class:"flex items-center"},Q={class:"w-full"},W={key:0,class:"flex items-center justify-center py-12"},X={key:1,class:"bg-red-50 border border-red-200 rounded-md p-4 mb-6"},Z={class:"flex"},ee={class:"ml-3"},te={class:"mt-2 text-sm text-red-700"},ae={key:2,class:"bg-white py-8 px-6 shadow sm:rounded-lg"},se={class:"mt-1"},oe={key:0,class:"mt-2 text-sm text-red-600"},re={class:"mt-1"},ne={key:0,class:"mt-2 text-sm text-red-600"},le={class:"mt-2 text-sm text-gray-500"},ie={key:0,class:"bg-red-50 border border-red-200 rounded-md p-4"},de={class:"flex"},ce={class:"ml-3"},ue={class:"mt-2 text-sm text-red-700"},me=M({__name:"editCategory",props:{id:{}},setup(E){const V=E,y=F(),D=T(),{getCategory:N,updateCategory:j}=A(),a=i({name:"",description:""}),d=i(!1),v=i(!1),s=i(""),r=i({}),g=i(0),z=R(()=>a.value.name.trim().length>=2&&!d.value);S(async()=>{await I()});async function I(){const o=V.id||D.params.id;if(!o){s.value="ID de categoría no válido";return}v.value=!0,s.value="";try{g.value=Number(o);const t=await N(g.value);a.value={name:t.name,description:t.description||""}}catch(t){console.error("Error al cargar categoría:",t),t?.response?.status===404?s.value="Categoría no encontrada":s.value=t?.response?.data?.error||"Error al cargar la categoría"}finally{v.value=!1}}function B(){return r.value={},a.value.name.trim()?a.value.name.trim().length<2?r.value.name="El nombre debe tener al menos 2 caracteres":a.value.name.trim().length>100&&(r.value.name="El nombre no puede exceder 100 caracteres"):r.value.name="El nombre es obligatorio",a.value.description&&a.value.description.length>500&&(r.value.description="La descripción no puede exceder 500 caracteres"),Object.keys(r.value).length===0}async function h(){if(B()){d.value=!0,s.value="";try{const o={name:a.value.name.trim(),description:a.value.description?.trim()||void 0};await j(g.value,o),y.push({path:"/adminproductos/categorias",query:{success:"updated",name:o.name}})}catch(o){console.error("Error al actualizar categoría:",o),o?.response?.status===409||o?.response?.data?.message?.includes("único")?s.value=`Ya existe una categoría con el nombre "${a.value.name}"`:o?.response?.status===401?s.value="No tienes permisos para editar categorías":o?.response?.status===404?s.value="Categoría no encontrada":s.value=o?.response?.data?.error||"Error inesperado al actualizar la categoría",G.error("Error al actualizar la categoría",{autoClose:2e3})}finally{d.value=!1}}}function _(){y.push("/adminproductos/categorias")}return(o,t)=>(l(),n("div",H,[e("div",L,[e("div",O,[e("button",{onClick:_,type:"button",class:"inline-flex items-center text-sm text-indigo-600 hover:text-indigo-800"},[u(m(p),{icon:"mdi:arrow-left",class:"w-5 h-5 mr-2"}),t[2]||(t[2]=x(" Volver ",-1))])]),e("div",Y,[t[5]||(t[5]=e("div",{class:"text-left"},[e("h2",{class:"text-3xl font-extrabold text-gray-900"},"Editar Detalles de Categoría"),e("p",{class:"mt-1 text-sm text-gray-600"},"Modifica el nombre o la descripción de la categoría")],-1)),e("div",$,[e("button",{onClick:h,type:"button",disabled:d.value||!z.value,class:"ml-4 inline-flex items-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},[d.value?(l(),n("div",K,[...t[3]||(t[3]=[e("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},null,-1),x(" Guardando... ",-1)])])):(l(),n("span",P,[u(m(p),{icon:"mdi:content-save",class:"w-4 h-4 mr-2"}),t[4]||(t[4]=x(" Guardar ",-1))]))],8,J)])])]),e("div",Q,[v.value?(l(),n("div",W,[...t[6]||(t[6]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"},null,-1),e("span",{class:"ml-2 text-slate-600"},"Cargando categoría...",-1)])])):s.value&&!a.value.name?(l(),n("div",X,[e("div",Z,[u(m(p),{icon:"mdi:alert-circle",class:"h-5 w-5 text-red-400"}),e("div",ee,[t[7]||(t[7]=e("h3",{class:"text-sm font-medium text-red-800"},"Error al cargar categoría",-1)),e("div",te,c(s.value),1),e("button",{onClick:_,class:"mt-3 text-red-800 underline hover:no-underline"}," Volver a la lista ")])])])):(l(),n("div",ae,[e("form",{onSubmit:q(h,["prevent"]),class:"space-y-6 w-full"},[e("div",null,[t[8]||(t[8]=e("label",{for:"name",class:"block text-sm font-medium text-gray-700"}," Nombre de la categoría * ",-1)),e("div",se,[w(e("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=f=>a.value.name=f),type:"text",required:"",maxlength:"100",class:C(["appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",{"border-red-300 focus:border-red-500 focus:ring-red-500":r.value.name}]),placeholder:"Ej: Hogar, Tecnología, Ropa..."},null,2),[[k,a.value.name]]),r.value.name?(l(),n("p",oe,c(r.value.name),1)):b("",!0)])]),e("div",null,[t[9]||(t[9]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700"}," Descripción (opcional) ",-1)),e("div",re,[w(e("textarea",{id:"description","onUpdate:modelValue":t[1]||(t[1]=f=>a.value.description=f),rows:"3",maxlength:"500",class:C(["appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",{"border-red-300 focus:border-red-500 focus:ring-red-500":r.value.description}]),placeholder:"Describe brevemente esta categoría..."},null,2),[[k,a.value.description]]),r.value.description?(l(),n("p",ne,c(r.value.description),1)):b("",!0),e("p",le,c(a.value.description?.length||0)+"/500 caracteres",1)])]),s.value?(l(),n("div",ie,[e("div",de,[u(m(p),{icon:"mdi:alert-circle",class:"h-5 w-5 text-red-400"}),e("div",ce,[t[10]||(t[10]=e("h3",{class:"text-sm font-medium text-red-800"},"Error al editar categoría",-1)),e("div",ue,c(s.value),1)])])])):b("",!0)],32)]))])]))}}),ge=U(me,[["__scopeId","data-v-75df9350"]]);export{ge as default};
