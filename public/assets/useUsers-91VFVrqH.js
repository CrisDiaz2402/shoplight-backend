import{r as l,j as y,f as o}from"./index-C5EFz0i3.js";function C(){const s=l([]),i=l(!1),u=l(null),c=l(""),f=y(()=>{if(!c.value)return s.value;const e=c.value.toLowerCase();return s.value.filter(r=>r.name.toLowerCase().includes(e)||r.email.toLowerCase().includes(e))});async function d(){i.value=!0,u.value=null;try{const e=await o.get("/auth/users",{params:{role:"admin"}});return s.value=Array.isArray(e.data)?e.data:[],s.value}catch(e){throw u.value=e?.response?.data?.message||e?.message||"Error cargando usuarios",e}finally{i.value=!1}}async function h(e){try{const r=s.value.find(n=>n.id===e);if(r)return r;await d();const t=s.value.find(n=>n.id===e);if(t)return t;const a=new Error("Usuario no encontrado");throw a.response={status:404,data:{message:"Usuario no encontrado"}},a}catch(r){throw r}}async function v(e){try{const r=await o.post("/auth/register",{name:e.name,email:e.email,password:e.password}),t=r?.data?.user??r?.data;if(e.role&&e.role!=="client"&&t&&t.id)try{const a=await o.put(`/auth/users/${t.id}`,{role:e.role}),n=a?.data?.user??a?.data;n?t.role=n.role??e.role:t.role=e.role}catch(a){console.warn("No se pudo establecer role tras registro:",a)}return s.value.unshift(t),t}catch(r){throw r}}async function w(e,r){try{const a=(await o.put(`/auth/users/${e}`,r)).data,n=s.value.findIndex(g=>g.id===e);return n!==-1&&(s.value[n]=a),a}catch(t){throw t}}async function p(e){try{return await o.delete(`/auth/users/${e}`),s.value=s.value.filter(r=>r.id!==e),!0}catch(r){throw r}}function m(e){c.value=e}function U(){u.value=null}return{users:s,filteredUsers:f,loading:i,error:u,searchQuery:c,fetchUsers:d,getUser:h,createUser:v,updateUser:w,deleteUser:p,setSearchQuery:m,clearError:U}}export{C as u};
