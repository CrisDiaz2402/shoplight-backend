import{d as R,r as _,o as j,s as z,l as m,v as B,c as o,a as e,b as l,u as a,I as d,x as I,t as c,F as S,e as T,h as n,_ as V}from"./index-C5EFz0i3.js";import{u as F}from"./useCategories-C0eZ0PpZ.js";import{D as L}from"./deletedPanel-It5FEFuC.js";const M={class:"space-y-6"},G={class:"bg-white text-slate-900 p-8 rounded-md border border-slate-200"},O={class:"flex items-center justify-between gap-4"},P={key:0,class:"flex items-center justify-center p-8"},Q={key:1,class:"bg-red-50 border border-red-200 rounded-md p-4 text-red-700"},H={class:"flex items-center"},J={key:2,class:"bg-white rounded-lg shadow overflow-hidden"},K={key:0,class:"text-center py-12"},U={class:"text-slate-500"},W={key:1,class:"min-w-full"},X={class:"bg-white divide-y divide-slate-200"},Y={class:"px-6 py-4 whitespace-nowrap"},Z={class:"text-sm font-medium text-slate-900"},ee={class:"px-6 py-4"},te={class:"text-sm text-slate-500"},se={class:"px-6 py-4 whitespace-nowrap text-sm text-slate-500"},ae={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},oe={class:"flex items-center justify-end gap-2"},ne=["onClick"],re=["onClick"],ie=R({__name:"categoryAdmin",setup(le){const p=B(),h=z(),{filteredCategories:x,loading:v,error:g,searchQuery:y,fetchCategories:f,deleteCategory:b,clearError:C}=F(),u=_(!1),r=_(null);j(async()=>{await f();const t=h.query.success,s=h.query.name;t&&s&&(setTimeout(()=>{t==="created"?m.success(`Categoría "${s}" creada exitosamente`,{autoClose:2e3}):t==="updated"&&m.success(`Categoría "${s}" actualizada exitosamente`,{autoClose:2e3})},100),p.replace({path:h.path}))});function w(t){if(!t)return"N/A";try{return new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}catch{return"N/A"}}function k(){p.push("/adminproductos/categorias/crear")}function D(t){p.push(`/adminproductos/categorias/${t.id}/editar`)}function N(t){if(t.productCount&&t.productCount>0){alert(`No se puede eliminar la categoría "${t.name}" porque tiene ${t.productCount} productos asociados.`);return}r.value=t,u.value=!0}async function E(){if(r.value)try{const t=r.value.name;await b(r.value.id),m.success(`Categoría "${t}" eliminada exitosamente`,{autoClose:2e3}),u.value=!1,r.value=null}catch(t){console.error("Error al eliminar categoría:",t);const s=t?.response?.data?.error||t?.response?.data?.message||"Error al eliminar la categoría";m.error(s,{autoClose:2e3})}}function $(){u.value=!1,r.value=null}function A(){C(),f()}return(t,s)=>(n(),o("section",M,[e("header",G,[e("div",O,[s[1]||(s[1]=e("div",null,[e("h1",{class:"text-3xl md:text-4xl font-extrabold"},"Gestión de Categorías"),e("p",{class:"text-slate-600 mt-2"},"Organiza tus categorías de productos")],-1)),e("button",{onClick:k,class:"flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md shadow"},[l(a(d),{icon:"mdi:plus",width:"18",height:"18"}),s[0]||(s[0]=e("span",null,"Crear Categoría",-1))])])]),e("main",null,[a(v)?(n(),o("div",P,[...s[2]||(s[2]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"},null,-1),e("span",{class:"ml-2 text-slate-600"},"Cargando categorías...",-1)])])):a(g)?(n(),o("div",Q,[e("div",H,[l(a(d),{icon:"mdi:alert-circle",width:"20",height:"20",class:"mr-2"}),I(" "+c(a(g)),1)]),e("button",{onClick:A,class:"mt-2 text-red-800 underline hover:no-underline"}," Reintentar ")])):(n(),o("div",J,[a(x).length===0?(n(),o("div",K,[l(a(d),{icon:"mdi:folder-open-outline",width:"48",height:"48",class:"mx-auto text-slate-300 mb-4"}),s[3]||(s[3]=e("h3",{class:"text-lg font-medium text-slate-900 mb-2"},"No hay categorías",-1)),e("p",U,c(a(y)?"No se encontraron categorías que coincidan con tu búsqueda.":"Comienza creando tu primera categoría."),1)])):(n(),o("table",W,[s[4]||(s[4]=e("thead",{class:"bg-slate-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider"}," Nombre "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider"}," Descripción "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider"}," Creado "),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider"}," Acciones ")])],-1)),e("tbody",X,[(n(!0),o(S,null,T(a(x),i=>(n(),o("tr",{key:i.id,class:"hover:bg-slate-50"},[e("td",Y,[e("div",Z,c(i.name),1)]),e("td",ee,[e("div",te,c(i.description||"Sin descripción"),1)]),e("td",se,c(w(i.createdAt)),1),e("td",ae,[e("div",oe,[e("button",{onClick:q=>D(i),class:"text-indigo-600 hover:text-indigo-900 p-1 rounded",title:"Editar categoría"},[l(a(d),{icon:"mdi:pencil",width:"16",height:"16"})],8,ne),e("button",{onClick:q=>N(i),class:"text-red-600 hover:text-red-900 p-1 rounded",title:"Eliminar categoría"},[l(a(d),{icon:"mdi:delete",width:"16",height:"16"})],8,re)])])]))),128))])]))]))]),l(L,{"is-visible":u.value,"item-type":"categoría","item-name":r.value?.name||"",onConfirm:E,onCancel:$},null,8,["is-visible","item-name"])]))}}),me=V(ie,[["__scopeId","data-v-d442b378"]]);export{me as default};
