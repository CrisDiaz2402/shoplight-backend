import{d as O,r as i,j as T,o as K,c as a,a as t,b as y,x as N,u as k,I as h,t as u,y as R,g as c,z as g,A as _,n as w,B as $,F as H,e as J,s as Q,f as W,v as X,l as Y,h as r,_ as Z}from"./index-C5EFz0i3.js";import{u as ee}from"./useProducts-LmEOPVqc.js";import{u as te}from"./useCategories-C0eZ0PpZ.js";const oe={class:"w-full"},se={class:"mb-6"},ae={class:"mb-3"},re={class:"flex items-start justify-between"},le={class:"flex items-center"},ne=["disabled"],ie={key:0,class:"flex items-center"},de={key:1,class:"flex items-center"},ue={class:"w-full"},ce={key:0,class:"flex items-center justify-center py-12"},me={key:1,class:"bg-red-50 border border-red-200 rounded-md p-4 mb-6"},pe={class:"flex"},ve={class:"ml-3"},ge={class:"mt-2 text-sm text-red-700"},fe={key:2,class:"bg-white py-8 px-6 shadow sm:rounded-lg"},be={class:"mt-1"},xe={key:0,class:"mt-2 text-sm text-red-600"},ye={class:"mt-1"},ke={key:0,class:"mt-2 text-sm text-red-600"},he={class:"mt-2 text-sm text-gray-500"},_e={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},we={class:"mt-1"},Ie={key:0,class:"mt-2 text-sm text-red-600"},Ne={class:"mt-1"},Ee={key:0,class:"mt-2 text-sm text-red-600"},Ce={class:"mt-1"},Ue=["value"],Pe={key:0,class:"mt-2 mb-4"},Ve={class:"relative inline-block"},Se=["src"],ze={class:"mt-2"},De={key:1,class:"mt-2 text-sm text-green-600"},Fe={key:2,class:"mt-1 text-xs text-gray-500"},je={key:3,class:"mt-1 text-xs text-gray-500"},Ae={key:0,class:"bg-red-50 border border-red-200 rounded-md p-4"},Be={class:"flex"},Me={class:"ml-3"},qe={class:"mt-2 text-sm text-red-700"},Ge=O({__name:"editProduct",props:{id:{}},setup(z){const D=z,E=X(),F=Q(),{getProduct:j,updateProduct:A}=ee(),{fetchCategories:B,filteredCategories:C}=te(),o=i({name:"",description:"",price:0,imageUrl:"",stock:0,categoryId:null}),m=i(!1),I=i(!1),p=i("Guardando..."),d=i(""),s=i({}),U=i([]),f=i(null),b=i(null),x=i(""),v=i(null),M=T(()=>{const l=!!o.value.name&&o.value.name.trim().length>=2,e=o.value.price!=null&&!isNaN(Number(o.value.price))&&Number(o.value.price)>=0;return l&&e&&!m.value});async function q(){const l=D.id||F.params.id;if(!l){d.value="ID de producto no válido";return}I.value=!0;try{f.value=Number(l);const e=await j(f.value);o.value={name:e.name||"",description:e.description||"",price:e.price??0,imageUrl:e.imageUrl||"",stock:e.stock??0,categoryId:e.categoryId??null},v.value=e.imageUrl||null}catch(e){console.error("Error al cargar producto:",e),e?.response?.status===404?d.value="Producto no encontrado":d.value=e?.response?.data?.message||"Error al cargar producto"}finally{I.value=!1}}function G(l){const e=l.target;e.files&&e.files[0]?(b.value=e.files[0],x.value=e.files[0].name):(b.value=null,x.value="")}function L(){return s.value={},!o.value.name||!o.value.name.trim()?s.value.name="El nombre es obligatorio":o.value.name.trim().length<2?s.value.name="El nombre debe tener al menos 2 caracteres":o.value.name.trim().length>200&&(s.value.name="El nombre no puede exceder 200 caracteres"),o.value.description&&o.value.description.length>1e3&&(s.value.description="La descripción no puede exceder 1000 caracteres"),o.value.price==null||isNaN(Number(o.value.price))?s.value.price="El precio es obligatorio y debe ser un número":Number(o.value.price)<0&&(s.value.price="El precio no puede ser negativo"),o.value.stock!=null&&(!Number.isInteger(o.value.stock)||o.value.stock<0)&&(s.value.stock="El stock debe ser un entero no negativo"),Object.keys(s.value).length===0}async function P(){if(L()&&f.value){m.value=!0,d.value="",p.value="Procesando...";try{let l=o.value.imageUrl;if(b.value){p.value="Subiendo nueva imagen...";const S=new FormData;S.append("imagen",b.value),l=(await W.post("/products/upload-image",S,{headers:{"Content-Type":"multipart/form-data"}})).data.imageKey}p.value="Actualizando producto...";const e={name:o.value.name.trim(),description:o.value.description?.trim()||void 0,price:Number(o.value.price),imageUrl:l||void 0,stock:o.value.stock!=null?Number(o.value.stock):0,categoryId:o.value.categoryId??void 0},n=await A(f.value,e);E.push({path:"/adminproductos",query:{success:"updated",name:n.name}})}catch(l){console.error("Error al actualizar producto:",l);const e=l?.response?.data?.message||l?.response?.data?.error||"Error inesperado al actualizar el producto";l?.response?.status===404?d.value="Producto no encontrado":d.value=e,Y.error("Error al actualizar producto",{autoClose:2e3})}finally{m.value=!1,p.value="Guardando..."}}}function V(){E.push("/adminproductos")}return K(async()=>{try{await B(),U.value=Array.isArray(C.value)?C.value:[]}catch{}await q()}),(l,e)=>(r(),a("div",oe,[t("div",se,[t("div",ae,[t("button",{onClick:V,type:"button",class:"inline-flex items-center text-sm text-indigo-600 hover:text-indigo-800"},[y(k(h),{icon:"mdi:arrow-left",class:"w-5 h-5 mr-2"}),e[6]||(e[6]=N(" Volver ",-1))])]),t("div",re,[e[9]||(e[9]=t("div",{class:"text-left"},[t("h2",{class:"text-3xl font-extrabold text-gray-900"},"Editar Producto"),t("p",{class:"mt-1 text-sm text-gray-600"},"Actualiza los datos del producto")],-1)),t("div",le,[t("button",{onClick:P,type:"button",disabled:m.value||!M.value,class:"ml-4 inline-flex items-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},[m.value?(r(),a("div",ie,[e[7]||(e[7]=t("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},null,-1)),N(" "+u(p.value),1)])):(r(),a("span",de,[y(k(h),{icon:"mdi:content-save",class:"w-4 h-4 mr-2"}),e[8]||(e[8]=N(" Guardar ",-1))]))],8,ne)])])]),t("div",ue,[I.value?(r(),a("div",ce,[...e[10]||(e[10]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"},null,-1),t("span",{class:"ml-2 text-slate-600"},"Cargando producto...",-1)])])):d.value&&!o.value.name?(r(),a("div",me,[t("div",pe,[y(k(h),{icon:"mdi:alert-circle",class:"h-5 w-5 text-red-400"}),t("div",ve,[e[11]||(e[11]=t("h3",{class:"text-sm font-medium text-red-800"},"Error al cargar producto",-1)),t("div",ge,u(d.value),1),t("button",{onClick:V,class:"mt-3 text-red-800 underline hover:no-underline"},"Volver a la lista")])])])):(r(),a("div",fe,[t("form",{onSubmit:R(P,["prevent"]),class:"space-y-6 w-full"},[t("div",null,[e[12]||(e[12]=t("label",{for:"name",class:"block text-sm font-medium text-gray-700"},"Nombre *",-1)),t("div",be,[g(t("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=n=>o.value.name=n),type:"text",required:"",maxlength:"200",class:w(["appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",{"border-red-300 focus:border-red-500 focus:ring-red-500":s.value.name}]),placeholder:"Ej: Auriculares Inalámbricos"},null,2),[[_,o.value.name]]),s.value.name?(r(),a("p",xe,u(s.value.name),1)):c("",!0)])]),t("div",null,[e[13]||(e[13]=t("label",{for:"description",class:"block text-sm font-medium text-gray-700"},"Descripción (opcional)",-1)),t("div",ye,[g(t("textarea",{id:"description","onUpdate:modelValue":e[1]||(e[1]=n=>o.value.description=n),rows:"3",maxlength:"1000",class:w(["appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",{"border-red-300 focus:border-red-500 focus:ring-red-500":s.value.description}]),placeholder:"Describe brevemente el producto..."},null,2),[[_,o.value.description]]),s.value.description?(r(),a("p",ke,u(s.value.description),1)):c("",!0),t("p",he,u(o.value.description?.length||0)+"/1000 caracteres",1)])]),t("div",_e,[t("div",null,[e[14]||(e[14]=t("label",{for:"price",class:"block text-sm font-medium text-gray-700"},"Precio (USD) *",-1)),t("div",we,[g(t("input",{id:"price","onUpdate:modelValue":e[2]||(e[2]=n=>o.value.price=n),type:"number",step:"0.01",min:"0",required:"",class:w(["appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",{"border-red-300 focus:border-red-500 focus:ring-red-500":s.value.price}]),placeholder:"0.00"},null,2),[[_,o.value.price,void 0,{number:!0}]]),s.value.price?(r(),a("p",Ie,u(s.value.price),1)):c("",!0)])]),t("div",null,[e[15]||(e[15]=t("label",{for:"stock",class:"block text-sm font-medium text-gray-700"},"Stock",-1)),t("div",Ne,[g(t("input",{id:"stock","onUpdate:modelValue":e[3]||(e[3]=n=>o.value.stock=n),type:"number",step:"1",min:"0",class:w(["appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",{"border-red-300 focus:border-red-500 focus:ring-red-500":s.value.stock}]),placeholder:"0"},null,2),[[_,o.value.stock,void 0,{number:!0}]]),s.value.stock?(r(),a("p",Ee,u(s.value.stock),1)):c("",!0)])]),t("div",null,[e[17]||(e[17]=t("label",{for:"category",class:"block text-sm font-medium text-gray-700"},"Categoría",-1)),t("div",Ce,[g(t("select",{id:"category","onUpdate:modelValue":e[4]||(e[4]=n=>o.value.categoryId=n),class:"block w-full rounded-md border-gray-300 shadow-sm sm:text-sm py-2 px-3"},[e[16]||(e[16]=t("option",{value:null},"Sin categoría",-1)),(r(!0),a(H,null,J(U.value,n=>(r(),a("option",{key:n.id,value:n.id},u(n.name),9,Ue))),128))],512),[[$,o.value.categoryId]])])])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700"},"Imagen del Producto",-1)),v.value?(r(),a("div",Pe,[e[18]||(e[18]=t("p",{class:"text-sm text-gray-600 mb-2"},"Imagen actual:",-1)),t("div",Ve,[t("img",{src:v.value,alt:"Imagen actual del producto",class:"w-32 h-32 object-cover rounded-lg border border-gray-200",onError:e[5]||(e[5]=n=>v.value=null)},null,40,Se)])])):c("",!0),t("div",ze,[t("input",{type:"file",onChange:G,accept:"image/*",class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"},null,32)]),x.value?(r(),a("p",De," Nueva imagen seleccionada: "+u(x.value),1)):v.value?(r(),a("p",je," Selecciona un archivo para reemplazar la imagen actual. ")):(r(),a("p",Fe," No hay imagen asignada. Selecciona un archivo para agregar una. "))]),d.value?(r(),a("div",Ae,[t("div",Be,[y(k(h),{icon:"mdi:alert-circle",class:"h-5 w-5 text-red-400"}),t("div",Me,[e[20]||(e[20]=t("h3",{class:"text-sm font-medium text-red-800"},"Error al actualizar producto",-1)),t("div",qe,u(d.value),1)])])])):c("",!0)],32)]))])]))}}),Re=Z(Ge,[["__scopeId","data-v-705b7c35"]]);export{Re as default};
